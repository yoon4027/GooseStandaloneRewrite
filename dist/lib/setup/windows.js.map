{"version":3,"sources":["../../../src/lib/setup/windows.ts"],"sourcesContent":["import { copyDir } from \"#lib/util\";\nimport { Logger } from \"@dimensional-fun/logger\";\nimport { execSync } from \"child_process\";\nimport { existsSync } from \"fs\";\nimport { readdir, rm } from \"fs/promises\";\nimport { join } from \"path\";\n\nconst logger = new Logger(\"win-setup\");\n\nexport const setupWindows = async ({ basePath }: SetupWindowsArgs) => {\n  logger.info(\"Computing paths...\");\n\n  const oldAppPath = join(basePath, `app-0.0.0`);\n\n  const exePath = join(\n    oldAppPath,\n    (await readdir(oldAppPath)).find((x) => x.includes(\".exe\"))!\n  );\n\n  if (!existsSync(exePath))\n    return logger.error(\"Couldn't find the executable file.\");\n\n  logger.warn(\"Running Discord to generate installer.db...\");\n\n  execSync(`\"${exePath}\"`, { stdio: \"inherit\" });\n\n  logger.info(\"Ran, finding new app dir\");\n\n  const newAppPath = join(\n    basePath,\n    (await readdir(basePath)).find((x) => x.startsWith(`app-1.`))!\n  );\n\n  logger.warn(\"Copying modules from new to old...\");\n\n  await copyDir({\n    from: join(newAppPath, \"modules\"),\n    to: join(oldAppPath, \"modules\"),\n  });\n\n  logger.info(\"Removing new...\");\n\n  await rm(newAppPath, { recursive: true, force: true });\n\n  logger.info(\"Renaming old to new...\");\n\n  await copyDir({\n    from: oldAppPath,\n    to: newAppPath,\n  });\n\n  return await rm(oldAppPath, { recursive: true, force: true });\n};\n\ninterface SetupWindowsArgs {\n  basePath: string;\n}\n"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA,MAAM,SAAS,IAAI,OAAO,WAAW;AAE9B,MAAM,eAAe,8BAAO,EAAE,eAAiC;AACpE,SAAO,KAAK,oBAAoB;AAEhC,QAAM,aAAa,KAAK,UAAU,WAAW;AAE7C,QAAM,UAAU,KACd,YACC,OAAM,QAAQ,UAAU,GAAG,KAAK,CAAC,MAAM,EAAE,SAAS,MAAM,CAAC,CAC5D;AAEA,MAAI,CAAC,WAAW,OAAO;AACrB,WAAO,OAAO,MAAM,oCAAoC;AAE1D,SAAO,KAAK,6CAA6C;AAEzD,WAAS,IAAI,YAAY,EAAE,OAAO,UAAU,CAAC;AAE7C,SAAO,KAAK,0BAA0B;AAEtC,QAAM,aAAa,KACjB,UACC,OAAM,QAAQ,QAAQ,GAAG,KAAK,CAAC,MAAM,EAAE,WAAW,QAAQ,CAAC,CAC9D;AAEA,SAAO,KAAK,oCAAoC;AAEhD,QAAM,QAAQ;AAAA,IACZ,MAAM,KAAK,YAAY,SAAS;AAAA,IAChC,IAAI,KAAK,YAAY,SAAS;AAAA,EAChC,CAAC;AAED,SAAO,KAAK,iBAAiB;AAE7B,QAAM,GAAG,YAAY,EAAE,WAAW,MAAM,OAAO,KAAK,CAAC;AAErD,SAAO,KAAK,wBAAwB;AAEpC,QAAM,QAAQ;AAAA,IACZ,MAAM;AAAA,IACN,IAAI;AAAA,EACN,CAAC;AAED,SAAO,MAAM,GAAG,YAAY,EAAE,WAAW,MAAM,OAAO,KAAK,CAAC;AAC9D,GA3C4B;","names":[]}